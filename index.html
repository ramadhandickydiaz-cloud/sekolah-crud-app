<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Manajemen Sekolah</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 20px;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .navbar-brand {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-primary mb-4">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-school"></i> Sistem Manajemen Sekolah
            </a>
        </div>
    </nav>

    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h4><i class="fas fa-info-circle"></i> Selamat Datang</h4>
                    </div>
                    <div class="card-body">
                        <h5>Aplikasi CRUD Manajemen Data Sekolah</h5>
                        <p>Teknologi: Flask + SQLite + Bootstrap</p>
                        
                        <div class="row mt-4">
                            <div class="col-md-4">
                                <div class="card text-white bg-info">
                                    <div class="card-body text-center">
                                        <h1 id="total-siswa">0</h1>
                                        <p><i class="fas fa-users"></i> Total Siswa</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-white bg-warning">
                                    <div class="card-body text-center">
                                        <h1><i class="fas fa-database"></i></h1>
                                        <p>SQLite Database</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-white bg-danger">
                                    <div class="card-body text-center">
                                        <h1><i class="fas fa-code"></i></h1>
                                        <p>Flask REST API</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h4><i class="fas fa-list"></i> Menu Aplikasi</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <a href="/api/siswa" class="btn btn-primary btn-lg w-100">
                                    <i class="fas fa-users"></i><br>Data Siswa (JSON)
                                </a>
                            </div>
                            <div class="col-md-3 mb-3">
                                <a href="/dashboard" class="btn btn-success btn-lg w-100">
                                    <i class="fas fa-tachometer-alt"></i><br>Dashboard
                                </a>
                            </div>
                            <div class="col-md-3 mb-3">
                                <button class="btn btn-info btn-lg w-100" onclick="testAPI()">
                                    <i class="fas fa-bolt"></i><br>Test API
                                </button>
                            </div>
                            <div class="col-md-3 mb-3">
                                <a href="http://localhost:5000/api/siswa" target="_blank" class="btn btn-warning btn-lg w-100">
                                    <i class="fas fa-external-link-alt"></i><br>API di Tab Baru
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h4><i class="fas fa-table"></i> Data Siswa Terbaru</h4>
                    </div>
                    <div class="card-body">
                        <div id="siswa-container">
                            <p>Loading data...</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h4><i class="fas fa-terminal"></i> Test API Manual</h4>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Endpoint:</label>
                            <input type="text" class="form-control" value="/api/siswa" id="endpoint" readonly>
                        </div>
                        <button class="btn btn-primary" onclick="fetchData()">
                            <i class="fas fa-sync"></i> Fetch Data
                        </button>
                        <div class="mt-3">
                            <pre id="api-result" class="bg-dark text-light p-3 rounded" style="height: 200px; overflow: auto;">
Klik "Fetch Data" untuk melihat hasil
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white text-center py-3 mt-4">
        <div class="container">
            <p>Cloud Computing Project - Sistem Manajemen Sekolah</p>
            <p>Flask + SQLite + Bootstrap | Running on port 5000</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Load total siswa
        async function loadTotalSiswa() {
            try {
                const response = await fetch('/api/siswa');
                const data = await response.json();
                document.getElementById('total-siswa').textContent = data.length;
                
                // Tampilkan data di tabel
                let html = '<table class="table table-striped"><thead><tr><th>NIS</th><th>Nama</th><th>Kelas</th><th>Alamat</th></tr></thead><tbody>';
                data.forEach(siswa => {
                    html += `<tr>
                        <td>${siswa.nis}</td>
                        <td>${siswa.nama}</td>
                        <td><span class="badge bg-primary">${siswa.kelas}</span></td>
                        <td>${siswa.alamat || '-'}</td>
                    </tr>`;
                });
                html += '</tbody></table>';
                document.getElementById('siswa-container').innerHTML = html;
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Test API
        function testAPI() {
            fetch('/api/siswa')
                .then(response => response.json())
                .then(data => {
                    alert(`API berhasil! Ada ${data.length} data siswa.`);
                })
                .catch(error => {
                    alert('Error: ' + error);
                });
        }

        // Fetch data untuk preview
        function fetchData() {
            fetch('/api/siswa')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('api-result').textContent = 
                        JSON.stringify(data, null, 2);
                });
        }

        // Load data saat halaman terbuka
        document.addEventListener('DOMContentLoaded', loadTotalSiswa);
    </script>
</body>
</html>
